#!/usr/bin/env bash

RSC_AUTH_LOGFILE=${RSC_AUTH_LOGFILE:-${2}}

function debug() {
    if [[ -z ${RSC_AUTH_LOGFILE} ]]; then
	echo "$@"
    else
	echo "$@" >> "${RSC_AUTH_LOGFILE}"
    fi
}


# Confirm username is supplied
if [[ $# -lt 1 ]]; then
  debug "Usage: $(basename "$0") <username>"
  exit 1
fi
RSC_USERNAME="${1}"

# Confirm password environment variable exists
if [[ -z ${RSC_PASSWORD} ]]; then
  debug "The environment variable RSC_PASSWORD is not set"
  exit 1
fi

if [[ "${RSC_USERNAME}" != "${USER}" ]]; then
  debug "Invalid authentication (incorrect username)"
  exit 1
fi

# Read in the password from user
read -r -s -p "Password: " password

if [[ "${RSC_PASSWORD}" != "${password}" ]]; then
  debug "Invalid authentication (incorrect password)"
  exit 1
fi

debug "Successful authentication"
exit 0
